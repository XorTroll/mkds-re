{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Mario Kart DS (EU) reverse-engineering","text":"<p>Hi! I'm XorTroll, welcome to my Mario Kart DS (EU) documentation!</p> <p>This page documents all about the game's functiobality. It will be progresivelly filled as a broader part of the project is fully decompiled/reversed/understood ;)</p> <p>Feel free to check the existing tools and code at the the GitHub repository.</p> <p>Would you like to use decompilated resources to make ASM-hacks? Check the examples!</p> <p>Check out our Mario Kart DS save editor!</p>"},{"location":"fs/","title":"TODO","text":""},{"location":"logic/","title":"TODO","text":""},{"location":"navigation/","title":"Navigation utilities","text":"<p>There are a few UI navigation utilities, together managed by a global object and various global subobjects, that are used by several scenes:</p>"},{"location":"navigation/#text-system-dialogs","title":"Text system (dialogs)","text":"<p>The so-called text system (name taken from the various <code>txt_system_*</code> graphics used by it) deals with displaying dialogs. These dialog system is used by <code>Logo</code>, <code>Result</code> (only when winning a gold/silver/bronze trophy), <code>WLMenu</code> (if not multi-boot), <code>Menu</code> (if multi-boot), <code>Menu</code> and <code>XXX</code> scenes.</p> <p>These can be of three kinds: single-button dialogs, double-button dialogs, or progress dialogs (buttonless dialogs, essentially)</p> <p></p> <p>Example navigation/dialog used by the <code>Nickname</code> scene: double-button dialog, with backscreen enabled, and with color blending enabled in both screens. The color on the player nickname comes from BMG escape formatting (TODO: write/link to that).</p>"},{"location":"navigation/#progress-buttonless-dialogs","title":"Progress (buttonless) dialogs","text":"<p>These dialogs can be shown at the top or bottom screen (two separate functions exist, one for each case, sharing similar logic).</p> <p>They can be displayed along with spinning-wheel animations (see below):</p> <p></p> <p>Example progress dialog.</p>"},{"location":"navigation/#singledouble-button-dialogs","title":"Single/double-button dialogs","text":"<p>These dialogs can only be shown at the bottom screen.</p> <p> </p> <p>Example single and double button dialogs.</p>"},{"location":"navigation/#dialog-parameters","title":"Dialog parameters","text":"<p>The following parameters can be used to configure a dialog to be shown (can be passed to dedicated functions to create/show dialogs):</p>"},{"location":"navigation/#caption-text","title":"Caption text","text":"<p>UTF-16 text shown in the dialog box.</p> <p>If the text is too long to fit the box, the box will just show empty (the text-printing code recognizes and split lines by <code>\\n</code> terminators).</p>"},{"location":"navigation/#button-texts","title":"Button texts","text":"<p>UTF-16 texts for buttons (one for single-button dialogs, two for double-button dialogs).</p>"},{"location":"navigation/#fade-in-initial-y-position","title":"Fade-in initial Y position","text":"<p>Boolean that controls how the fade-in procedure works. The value is treated as an index in an internal array, where <code>0</code> corresponds to a (16-bit) value of <code>y = 160</code> and <code>1</code> to a value of <code>y = -176</code>.</p> <p>The dialog Y value is set a value of <code>y = -192</code> on initialization. This is done so that, regardless of this initial Y parameter, the dialog will be hidden in the first frame.</p> <p>Then, the base Y position will be computed with a smooth interpolation (using trigonometric functions) from the given initial value to <code>y = 0</code>. Hence, param <code>0</code> causes the dialog to appear from the bottom screen, and param <code>1</code> causes it to appear from the top screen, having therefore two fade-in directions.</p>"},{"location":"navigation/#fade-out-final-y-position","title":"Fade-out final Y position","text":"<p>Boolean that controls how the fade-out procedure works. Works similar to the previous parameter, where values of <code>0</code> and <code>1</code> corresponds to the same Y positions as above.</p> <p>In fade-out, the base Y position will be computed with a smooth interpolation (using trigonometric functions) from <code>y = 0</code> to the final Y value. Hence, the effect is the same as above, but with opposite directions (the same value for both fade-in and fade-out will cause the dialog to fade out in reverse as it faded in, essentially \"returning to its original place\").</p>"},{"location":"navigation/#progress-animation-flags-topsub-screen","title":"Progress animation flags (top/sub screen)","text":"<p>Booleans that indicate whether to show and animate the spinning-wheel animation (only usable in progress dialogs, per the exposed function arguments). </p> <p>Bottom-screen progress dialogs only can customize the bottom screen animation, while top screen ones can customize both:</p> <p> </p> <p> </p>"},{"location":"navigation/#initially-selected-button","title":"Initially selected button","text":"<p>For double button dialogs, a boolean is required (in the dedicated functions) to specify whether the first button (<code>0</code>) or the second button (<code>1</code>) is initially focused.</p> <p>All possible combinations of progress dialog animations</p> <ul> <li>Blend flags (top/sub screen): booleans that indicate whether to blend colors in the respective screen. This effect is not appreciated unless the backscreen is enabled in the navigation:</li> </ul> <p> </p> <p>All possible dialog/screen blending combinations</p> <p>Appart from these, there are exposed functions to set the following fields:</p> <ul> <li> <p>Which input to use (TODO: detail this a bit more?)</p> </li> <li> <p>Some yet-unknown, graphics-related values (TODO)</p> </li> <li> <p>Single/left button press SSEQ ID of SARC <code>0</code> (default: <code>5</code>)</p> </li> <li> <p>Right button press SSEQ ID of SARC <code>0</code> (default: <code>16</code>)</p> </li> </ul> <p>TODO: all these above two do not appear to be used at all...? Are they used in some overlay perhaps?</p> <ul> <li> <p>Dialog fade-in SSEQ ID of SARC <code>0</code> (default: <code>35</code>)</p> </li> <li> <p>For example, used when unlocking something (as a \"special\" dialog, with a different jingle)</p> </li> </ul> <p>When initializing the text system, the following fields can be set:</p> <ul> <li> <p>The dialog font (TODO: page about fonts).</p> </li> <li> <p>Flags regarding which sprites should be loaded</p> </li> <li> <p>All usages of these flags always set them in the same way, and disabling some of them will just show no dialog at all.</p> </li> </ul>"},{"location":"navigation/#dialog-logic","title":"Dialog logic","text":"<p>The dialog jumps between different states:</p> <ul> <li> <p>State <code>0</code> (initial state):</p> </li> <li> <p>Performs initial dialog loading, if needed (a flag encodes that), then jumps to state <code>1</code></p> </li> <li> <p>Otherwise, does nothing (happens when the dialog is closed)</p> <p>By this point, the code using the dialog will finally check the player input (if needed, for single-button dialogs can be obviously ignored) and continue with its own logic.</p> </li> <li> <p>State <code>1</code>:</p> </li> <li> <p>Shows fade-in animation, then jumps to state <code>2</code></p> </li> <li> <p>State <code>2</code>:</p> </li> <li> <p>If closing was requested (checks corresponding flag) jumps to state <code>4</code></p> </li> <li>Performs input checking<ul> <li>Button bounds for (single and double cases) are hardcoded, performs bounds checking against touch position</li> <li>If LEFT/RIGHT button movement was done, plays corresponding SSEQ ID (see above) and updates button graphics.</li> <li>If a button was pressed (via A/touch): corresponding SSEQ ID (see above) and jumps to state <code>3</code></li> </ul> </li> <li> <p>Thus, the dialog will stay in this state until any input is received by the player</p> </li> <li> <p>State <code>3</code>:</p> </li> <li> <p>Shows button press animation</p> </li> <li> <p>Sets a flag indicating that a button was pressed, then jumps again to <code>2</code></p> <p>Note: by this point, the code using the dialog should check that this flag was set (using the dedicated function for it), and \"acknowledge\" that the player selected a button by requesting to close the dialog (also using a dedicated function) (see above).</p> </li> <li> <p>State <code>4</code>:</p> </li> <li> <p>Shows fade-out animation, then jumps to <code>0</code> (the dialog finishes)</p> </li> </ul>"},{"location":"scenes/logo/","title":"<code>Logo</code> scene","text":"<p>The <code>Logo</code> scene is the first scene shown in the game. After a fade in, it will show the initial \"Nintendo\" and \"All rights reserved (...)\" graphics over a black screen, then fade out, perform save-data loading and checking, and jump to the <code>Title</code> scene.</p>"},{"location":"scenes/logo/#initialization","title":"Initialization","text":"<p>The display is configured. An object is allocated for this context specially.</p> <p>The aforementioned graphics are read and loaded into memory, and a pointer to <code>common.bmg</code> is kept in order to use some of its strings.</p> <p>TODO: finish</p>"},{"location":"scenes/logo/#update","title":"Update","text":"<p>TODO</p>"},{"location":"scenes/logo/#states","title":"States","text":""},{"location":"scenes/logo/#vblank","title":"Vblank","text":"<p>TODO</p>"},{"location":"scenes/logo/#finalization","title":"Finalization","text":"<p>TODO</p>"},{"location":"scenes/menu2/","title":"<code>Menu2</code> scene","text":"<p>This scene appears to be unused.</p> <p>Loading this scene (using ASM-hacks, for instance) works fine without any crashes, but causes an endless black-screen loop (see below).</p> <p>This scene perhaps served as a transition scene between <code>Menu</code> and <code>Race</code> scenes at some early development stage, performing the logic necessary to start the ongoing race/battle/mission/etc, meanwhile displaying a black screen.</p> <p>This logic was probably moved to <code>Menu</code> scene altogether (TODO: verify this claim)</p>"},{"location":"scenes/menu2/#handlers","title":"Handlers","text":"<p>Note that the \"scene context\" argument passed to these handler functions is never used in all of them, hence the scene never exits by pointing to a new scene to jump to in said context, causing and endless loop of doing nothing (running the \"update\" and \"vblank\" handlers, but never getting to run the \"finalize\" handler which contains any meaningful logic).</p>"},{"location":"scenes/menu2/#initialization","title":"Initialization","text":"<p>Only the display is configured. Unlike other scenes, no object allocation/scene-unique logic is performed.</p>"},{"location":"scenes/menu2/#update","title":"Update","text":"<p>This is an empty function.</p>"},{"location":"scenes/menu2/#vblank","title":"Vblank","text":"<p>This is another empty function.</p>"},{"location":"scenes/menu2/#finalization","title":"Finalization","text":"<p>Interestingly, this is the only place where nontrivial logic happens.</p> <p>The scene checks what kind the ongoing \"next race\" will be.</p> <p>If it's a battle or a mission run, sets fields appropriately in order to display the battle intro (for battles) or directly jump to the race (for missions), as is the usual behaviour.</p> <p>If it's the award race, it performs some configuration of racers 4 to 8. Note that this check is performed by looking the course ID and checking if it's the <code>Award</code> course.</p> <p>If it's the credits (checking against <code>StaffRoll</code>/<code>StaffRollTrue</code> courses) it also seems to perform some racer configuration for the credits scene.</p> <p>It finishes by setting (properly setting) the cup ID value in the \"next race\" config, after computing it from the course ID.</p>"},{"location":"scenes/scenes/","title":"TODO","text":""}]}